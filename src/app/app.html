<!-- src/app/app.html -->
<div class="app-shell">
  <!-- HEADER + NAVBAR (cachÃ©e sur /login et /register) -->
  <header class="topbar" *ngIf="!isAuthPage()">
    <div class="logo">
      <span class="logo-title">Enoch Leathercraft</span>
    </div>

    <div class="topbar-right">
      <!-- Mini panier -->
      <div class="cart-wrapper"
           (mouseenter)="miniCartOpen = true"
           (mouseleave)="miniCartOpen = false">

        <button class="cart-button" (click)="goToCart()">
          <span class="cart-icon">ðŸ›’</span>
          <span class="cart-label">Panier</span>
          <span class="cart-badge" *ngIf="cartQuantity > 0">{{ cartQuantity }}</span>
        </button>

        <!-- POPUP PANIER -->
        <div class="cart-popover"
             *ngIf="miniCartOpen && (cart$ | async) as cart">

          <h3 class="cart-popover-title">Votre panier</h3>

          <ng-container *ngIf="cart.items.length; else emptyCart">
            <div class="cart-items">
              <div class="cart-item" *ngFor="let item of cart.items">
                <div class="cart-item-main">
                  <!-- Image affichÃ©e uniquement si imageUrl existe -->
                  <div class="cart-item-thumb" *ngIf="item.imageUrl">
                    <img [src]="item.imageUrl" [alt]="item.name" />
                  </div>

                  <div class="cart-item-info">
                    <div class="name">{{ item.name }}</div>
                    <div class="meta">
                      x{{ item.quantity }} â€¢
                      {{ item.unitPrice | currency:'EUR' }}
                    </div>
                  </div>
                </div>

                <div class="cart-item-total">
                  {{ item.lineTotal | currency:'EUR' }}
                </div>
              </div>
            </div>

            <div class="cart-popover-footer">
              <div class="summary">
                <span>{{ cart.totalQuantity }} article(s)</span>
                <span class="total">
                  {{ cart.totalAmount | currency:'EUR' }}
                </span>
              </div>
              <button class="view-cart-btn" (click)="goToCart()">
                Voir le panier
              </button>
            </div>
          </ng-container>

          <ng-template #emptyCart>
            <p class="empty-text">Votre panier est vide.</p>
          </ng-template>

        </div>
      </div>

      <!-- Compte / DÃ©connexion -->
      <button class="account-button" routerLink="/profile">
        <span class="icon">ðŸ‘¤</span>
        <span>Mon compte</span>
      </button>

      <button class="logout-button" (click)="logout()">
        DÃ©connexion
      </button>
    </div>
  </header>

  <!-- CONTENU DES PAGES -->
  <main class="page">
    <router-outlet></router-outlet>
  </main>
</div>
