<div class="app-shell">

  <!-- ======================= NAVBAR ======================= -->
  <header class="topbar" *ngIf="!isAuthPage()">

    <!-- LOGO + NAVIGATION -->
    <div class="topbar-left">
      <a routerLink="/home" class="brand">
        <img
          src="http://localhost:8080/uploads/products/logo.jpg"
          alt="Logo"
          class="brand-logo"
        />
        <span class="brand-title">EN0CH LEATHERCRAFT</span>
      </a>

      <!-- NAVIGATION PRINCIPALE -->
      <nav class="main-nav">
        <a routerLink="/home" routerLinkActive="active">Accueil</a>
        <a routerLink="/products" routerLinkActive="active">Tous les produits</a>
        <a routerLink="/products" [queryParams]="{ category: 'sacs' }">Sacs</a>
        <a routerLink="/products" [queryParams]="{ category: 'portefeuilles' }">Portefeuilles</a>
        <a routerLink="/products" [queryParams]="{ category: 'ceintures' }">Ceintures</a>
        <a routerLink="/products" [queryParams]="{ category: 'accessoires' }">Accessoires</a>
      </nav>
    </div>

    <!-- BOUTONS Ã€ DROITE -->
    <div class="topbar-right">

      <!-- MINI PANIER -->
      <div
        class="cart-wrapper"
        (mouseenter)="miniCartOpen = true"
        (mouseleave)="miniCartOpen = false"
      >

        <!-- BOUTON PANIER -->
        <button class="cart-button" (click)="goToCart()">
          <span class="cart-icon">ðŸ›’</span>
          <span class="cart-label">Panier</span>
          <span class="cart-badge" *ngIf="cartQuantity > 0">
            {{ cartQuantity }}
          </span>
        </button>

        <!-- POPOVER DU PANIER -->
        <div class="cart-popover" *ngIf="miniCartOpen && (cart$ | async) as cart">

          <h3 class="cart-popover-title">Votre panier</h3>

          <ng-container *ngIf="cart.items.length > 0; else emptyCart">
            <div class="cart-items">

              <div class="cart-item" *ngFor="let item of cart.items">
                <div class="cart-item-left">
                  <div class="cart-thumb" *ngIf="item.imageUrl">
                    <img [src]="item.imageUrl" [alt]="item.name" />
                  </div>

                  <div class="cart-info">
                    <div class="name">{{ item.name }}</div>
                    <div class="meta">
                      x{{ item.quantity }} â€¢ {{ item.unitPrice | currency:'EUR' }}
                    </div>
                  </div>
                </div>

                <div class="cart-item-total">
                  {{ item.lineTotal | currency:'EUR' }}
                </div>
              </div>
            </div>

            <div class="cart-popover-footer">
              <div class="summary">
                <span>{{ cart.totalQuantity }} article(s)</span>
                <span class="total">{{ cart.totalAmount | currency:'EUR' }}</span>
              </div>

              <button class="view-cart-btn" (click)="goToCart()">
                Voir le panier â†’
              </button>
            </div>
          </ng-container>

          <ng-template #emptyCart>
            <p class="empty-text">Votre panier est vide.</p>
          </ng-template>

        </div>

      </div>

      <!-- MON COMPTE -->
      <button class="account-button" routerLink="/profile">
        ðŸ‘¤ Mon compte
      </button>

      <!-- DECONNEXION -->
      <button class="logout-button" (click)="logout()">
        DÃ©connexion
      </button>

    </div>
  </header>

  <!-- ======================= CONTENU DES PAGES ======================= -->
  <main class="page">
    <router-outlet></router-outlet>
  </main>
</div>
