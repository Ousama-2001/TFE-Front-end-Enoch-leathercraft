<!-- src/app/app.html -->
<div class="app-shell">
  <!-- ======================= NAVBAR ======================= -->
  <header class="topbar" *ngIf="!isAuthPage()">
    <!-- LOGO + NAVIGATION -->
    <div class="topbar-left">
      <a routerLink="/home" class="brand">
        <img
          src="http://localhost:8080/uploads/products/logo.jpg"
          alt="Logo"
          class="brand-logo"
        />
        <span class="brand-title">ENOCH LEATHERCRAFT</span>
      </a>

      <!-- NAVIGATION PRINCIPALE -->
      <nav class="main-nav">
        <!-- Accueil -->
        <div class="nav-item">
          <a
            routerLink="/home"
            routerLinkActive="active"
            [routerLinkActiveOptions]="{ exact: true }"
          >
            {{ 'nav.home' | t }}
          </a>
        </div>

        <!-- HOMME -->
        <div class="nav-item has-dropdown">
          <a
            routerLink="/products"
            [queryParams]="{ segment: 'homme' }"
            routerLinkActive="active"
          >
            {{ 'nav.men' | t }}
          </a>

          <div class="nav-dropdown">
            <h4>{{ 'nav.men' | t }}</h4>
            <p class="dropdown-text">
              Sacs, sacoches et ceintures en cuir pour homme.
            </p>
            <div class="dropdown-links">
              <a
                [routerLink]="['/products']"
                [queryParams]="{
                  segment: 'homme',
                  category: 'sacs-sacoches'
                }"
              >
                Sacs &amp; sacoches
              </a>
              <a
                [routerLink]="['/products']"
                [queryParams]="{
                  segment: 'homme',
                  category: 'ceintures'
                }"
              >
                Ceintures
              </a>
            </div>
          </div>
        </div>

        <!-- FEMME -->
        <div class="nav-item has-dropdown">
          <a
            routerLink="/products"
            [queryParams]="{ segment: 'femme' }"
            routerLinkActive="active"
          >
            {{ 'nav.women' | t }}
          </a>

          <div class="nav-dropdown">
            <h4>{{ 'nav.women' | t }}</h4>
            <p class="dropdown-text">
              Sacs, sacoches et ceintures en cuir pour femme.
            </p>
            <div class="dropdown-links">
              <a
                [routerLink]="['/products']"
                [queryParams]="{
                  segment: 'femme',
                  category: 'sacs-sacoches'
                }"
              >
                Sacs &amp; sacoches
              </a>
              <a
                [routerLink]="['/products']"
                [queryParams]="{
                  segment: 'femme',
                  category: 'ceintures'
                }"
              >
                Ceintures
              </a>
            </div>
          </div>
        </div>

        <!-- PETITE MAROQUINERIE -->
        <div class="nav-item has-dropdown">
          <a
            routerLink="/products"
            [queryParams]="{ segment: 'petite-maroquinerie' }"
            routerLinkActive="active"
          >
            {{ 'nav.small-leather' | t }}
          </a>

          <div class="nav-dropdown">
            <h4>{{ 'nav.small-leather' | t }}</h4>
            <p class="dropdown-text">
              Portefeuilles, portes-cartes et sets de table en cuir.
            </p>
            <div class="dropdown-links">
              <a
                [routerLink]="['/products']"
                [queryParams]="{
                  segment: 'petite-maroquinerie',
                  category: 'portefeuilles'
                }"
              >
                Portefeuilles
              </a>
              <a
                [routerLink]="['/products']"
                [queryParams]="{
                  segment: 'petite-maroquinerie',
                  category: 'portes-cartes'
                }"
              >
                Portes-cartes
              </a>
              <a
                [routerLink]="['/products']"
                [queryParams]="{
                  segment: 'petite-maroquinerie',
                  category: 'sets-de-table'
                }"
              >
                Sets de table
              </a>
            </div>
          </div>
        </div>

        <!-- NOUVEAUT√âS -->
        <div class="nav-item">
          <a
            routerLink="/products"
            [queryParams]="{ sort: 'newest' }"
            routerLinkActive="active"
          >
            {{ 'nav.new' | t }}
          </a>
        </div>

        <!-- √Ä propos -->
        <div class="nav-item">
          <a routerLink="/about" routerLinkActive="active">
            {{ 'nav.about' | t }}
          </a>
        </div>

        <!-- Contact -->
        <div class="nav-item">
          <a routerLink="/contact" routerLinkActive="active">
            {{ 'nav.contact' | t }}
          </a>
        </div>
      </nav>
    </div>

    <!-- BOUTONS √Ä DROITE -->
    <div class="topbar-right">
      <!-- S√©lecteur de langue -->
      <div class="lang-switcher">
        <div class="lang-toggle">
          <div
            class="lang-toggle-indicator"
            [class.right]="currentLang === 'en'"
          ></div>

          <button
            type="button"
            class="lang-option"
            [class.active]="currentLang === 'fr'"
            (click)="changeLang('fr')"
          >
            <span class="lang-code">FR</span>
          </button>

          <button
            type="button"
            class="lang-option"
            [class.active]="currentLang === 'en'"
            (click)="changeLang('en')"
          >
            <span class="lang-code">EN</span>
          </button>
        </div>

        <span class="lang-label">üåç</span>
      </div>

      <!-- üî• WISHLIST ICON (juste avant le panier) -->
      <div class="wishlist-wrapper">
        <button
          class="wishlist-button"
          type="button"
          (click)="goToWishlist()"
          aria-label="Voir ma wishlist"
        >
          <span class="wishlist-icon">‚ô•</span>
          <span class="wishlist-badge" *ngIf="wishlistCount > 0">
            {{ wishlistCount }}
          </span>
        </button>
      </div>

      <!-- MINI PANIER -->
      <div
        class="cart-wrapper"
        (mouseenter)="miniCartOpen = true"
        (mouseleave)="miniCartOpen = false"
      >
        <!-- BOUTON PANIER -->
        <button class="cart-button" (click)="goToCart()">
          <span class="cart-icon">üß∫</span>
          <span class="cart-label">{{ 'nav.cart' | t }}</span>
          <span class="cart-badge" *ngIf="cartQuantity > 0">
            {{ cartQuantity }}
          </span>
        </button>

        <!-- POPOVER DU PANIER -->
        <div
          class="cart-popover"
          *ngIf="miniCartOpen && (cart$ | async) as cart"
        >
          <h3 class="cart-popover-title">{{ 'cart.title' | t }}</h3>

          <ng-container *ngIf="cart && cart.items.length > 0; else emptyCart">
            <div class="cart-items">
              <div class="cart-item" *ngFor="let item of cart.items">
                <div class="cart-item-left">
                  <div class="cart-thumb" *ngIf="item.imageUrl">
                    <img [src]="item.imageUrl" [alt]="item.name" />
                  </div>

                  <div class="cart-info">
                    <div class="name">{{ item.name }}</div>
                    <div class="meta">
                      x{{ item.quantity }} ‚Ä¢
                      {{ item.unitPrice | currency : 'EUR' }}
                    </div>
                  </div>
                </div>

                <div class="cart-item-total">
                  {{ item.lineTotal | currency : 'EUR' }}
                </div>
              </div>
            </div>

            <div class="cart-popover-footer">
              <div class="summary">
                <span>
                  {{ cart.totalQuantity }} {{ 'cart.itemsCount' | t }}
                </span>
                <span class="total">
                  {{ cart.totalAmount | currency : 'EUR' }}
                </span>
              </div>

              <button class="view-cart-btn" (click)="goToCart()">
                {{ 'cart.view' | t }}
              </button>
            </div>
          </ng-container>

          <ng-template #emptyCart>
            <p class="empty-text">{{ 'cart.empty' | t }}</p>
          </ng-template>
        </div>
      </div>

      <!-- MON COMPTE -->
      <button class="account-button" routerLink="/profile">
        üë§ {{ 'nav.account' | t }}
      </button>

      <!-- DECONNEXION -->
      <button class="logout-button" (click)="logout()">
        {{ 'nav.logout' | t }}
      </button>
    </div>
  </header>

  <!-- ======================= CONTENU DES PAGES ======================= -->
  <main class="page">
    <router-outlet></router-outlet>
  </main>
</div>
