<div class="app-shell">
  <header class="topbar" *ngIf="!isAuthPage()">
    <div class="topbar-left">
      <a routerLink="/home" class="brand">
        <img
          src="http://localhost:8080/uploads/products/logo.jpg"
          alt="Logo"
          class="brand-logo"
        />
        <span class="brand-title">ENOCH LEATHERCRAFT</span>
      </a>

      <nav class="main-nav">
        <div class="nav-item">
          <a routerLink="/home" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
            {{ 'nav.home' | t }}
          </a>
        </div>

        <div class="nav-item">
          <a routerLink="/products" [queryParams]="{ sort: 'newest' }" routerLinkActive="active">
            {{ 'nav.new' | t }}
          </a>
        </div>

        <div class="nav-item">
          <a routerLink="/products" [queryParams]="{ segment: 'homme' }" routerLinkActive="active">
            {{ 'nav.men' | t }}
          </a>
        </div>

        <div class="nav-item">
          <a routerLink="/products" [queryParams]="{ segment: 'femme' }" routerLinkActive="active">
            {{ 'nav.women' | t }}
          </a>
        </div>

        <div class="nav-item">
          <a
            routerLink="/products"
            [queryParams]="{ segment: 'petite-maroquinerie' }"
            routerLinkActive="active"
          >
            {{ 'nav.smallLeather' | t }}
          </a>
        </div>

        <div class="nav-item">
          <a routerLink="/about" routerLinkActive="active">{{ 'nav.about' | t }}</a>
        </div>

        <div class="nav-item">
          <a routerLink="/contact" routerLinkActive="active">{{ 'nav.contact' | t }}</a>
        </div>
      </nav>
    </div>

    <div class="topbar-right">
      <!-- üåç LANG -->
      <div class="lang-switcher">
        <div class="lang-toggle">
          <div class="lang-toggle-indicator" [class.right]="currentLang === 'en'"></div>

          <button type="button" class="lang-option" [class.active]="currentLang === 'fr'" (click)="changeLang('fr')">
            FR
          </button>

          <button type="button" class="lang-option" [class.active]="currentLang === 'en'" (click)="changeLang('en')">
            EN
          </button>
        </div>
        <span class="lang-label">üåç</span>
      </div>

      <!-- ‚ù§Ô∏è WISHLIST -->
      <div class="wishlist-wrapper">
        <button class="wishlist-button" type="button" (click)="goToWishlist()" aria-label="Wishlist">
          <span class="wishlist-icon">‚ô•</span>
          <span class="wishlist-badge" *ngIf="wishlistCount > 0">{{ wishlistCount }}</span>
        </button>
      </div>

      <!-- üß∫ PANIER -->
      <div
        class="cart-wrapper"
        (mouseenter)="miniCartOpen = true"
        (mouseleave)="miniCartOpen = false"
      >
        <button class="cart-button" (click)="goToCart()">
          üß∫
          <span class="cart-badge" *ngIf="cartQuantity > 0">{{ cartQuantity }}</span>
        </button>

        <div class="cart-popover" *ngIf="miniCartOpen && (cart$ | async) as cart">
          <h3 class="cart-popover-title">{{ 'cart.title' | t }}</h3>

          <div class="mini-timer" *ngIf="cart.items.length > 0">
            <ng-container *ngIf="(timeLeftMs$ | async) as ms">
              <span *ngIf="ms > 0">‚è≥ {{ formatMs(ms) }}</span>
              <span class="danger" *ngIf="ms === 0">‚åõ Expir√©</span>
            </ng-container>
          </div>

          <ng-container *ngIf="cart.items.length > 0; else emptyCart">
            <div class="cart-items">
              <div class="cart-item" *ngFor="let item of cart.items">
                <div class="cart-item-left">
                  <div class="cart-thumb">
                    <img
                      [src]="cartService.getCartItemImage(item)"
                      [alt]="item.name"
                      (error)="onImgError($event)"
                    />
                  </div>

                  <div class="cart-info">
                    <div class="name">{{ item.name }}</div>
                    <div class="meta">
                      x{{ item.quantity }} ‚Ä¢ {{ item.unitPrice | currency:'EUR' }}
                    </div>
                  </div>
                </div>

                <div class="cart-item-total">
                  {{ item.lineTotal | currency:'EUR' }}
                </div>
              </div>
            </div>

            <div class="cart-popover-footer">
              <div class="summary">
                <span>{{ cart.totalQuantity }} {{ 'cart.itemsCount' | t }}</span>
                <span class="total">{{ cart.totalAmount | currency:'EUR' }}</span>
              </div>

              <button class="view-cart-btn" (click)="goToCart()">
                {{ 'cart.view' | t }}
              </button>
            </div>
          </ng-container>

          <ng-template #emptyCart>
            <p class="empty-text">{{ 'cart.empty' | t }}</p>
          </ng-template>
        </div>
      </div>

      <!-- üë§ AUTH -->
      <ng-container *ngIf="isLoggedIn; else guest">
        <button class="btn-chip btn-account" routerLink="/profile">
          üë§ {{ 'nav.account' | t }}
        </button>
        <button class="btn-chip btn-logout" (click)="logout()">
          {{ 'nav.logout' | t }}
        </button>
      </ng-container>

      <ng-template #guest>
        <button class="btn-chip btn-login" routerLink="/login">{{ 'nav.login' | t }}</button>
        <button class="btn-chip btn-register" routerLink="/register">{{ 'nav.register' | t }}</button>
      </ng-template>

      <button class="burger" type="button" (click)="mobileNavOpen = !mobileNavOpen">‚ò∞</button>
    </div>

    <div class="mobile-nav" *ngIf="mobileNavOpen">
      <a routerLink="/home" (click)="mobileNavOpen=false">{{ 'nav.home' | t }}</a>
      <a routerLink="/products" (click)="mobileNavOpen=false">{{ 'nav.new' | t }}</a>
      <a routerLink="/about" (click)="mobileNavOpen=false">{{ 'nav.about' | t }}</a>
      <a routerLink="/contact" (click)="mobileNavOpen=false">{{ 'nav.contact' | t }}</a>
    </div>
  </header>

  <div class="auth-warning" *ngIf="authWarning">{{ authWarning }}</div>

  <main class="page">
    <router-outlet></router-outlet>
  </main>

  <app-cookie-banner></app-cookie-banner>
</div>
