<div class="app-shell">

  <!-- ======================= NAVBAR ======================= -->
  <header class="topbar" *ngIf="!isAuthPage()">

    <!-- LOGO + NAVIGATION -->
    <div class="topbar-left">
      <a routerLink="/home" class="brand">
        <img
          src="http://localhost:8080/uploads/products/logo.jpg"
          alt="Logo"
          class="brand-logo"
        />
        <span class="brand-title">ENOCH LEATHERCRAFT</span>
      </a>

      <!-- NAVIGATION PRINCIPALE -->
      <nav class="main-nav">

        <!-- Accueil (pas de dropdown) -->
        <div class="nav-item">
          <a
            routerLink="/home"
            routerLinkActive="active"
            [routerLinkActiveOptions]="{ exact: true }"
          >
            Accueil
          </a>
        </div>

        <!-- HOMME -->
        <div class="nav-item has-dropdown">
          <a
            routerLink="/products"
            [queryParams]="{ segment: 'homme' }"
            routerLinkActive="active"
          >
            Homme
          </a>

          <div class="nav-dropdown">
            <h4>Pour homme</h4>
            <p class="dropdown-text">
              Sacs, sacoches et ceintures en cuir pour homme.
            </p>
            <div class="dropdown-links">
              <a
                [routerLink]="['/products']"
                [queryParams]="{ segment: 'homme', category: 'sacs-sacoches' }"
              >
                Sacs &amp; sacoches
              </a>
              <a
                [routerLink]="['/products']"
                [queryParams]="{ segment: 'homme', category: 'ceintures' }"
              >
                Ceintures
              </a>
            </div>
          </div>
        </div>

        <!-- FEMME -->
        <div class="nav-item has-dropdown">
          <a
            routerLink="/products"
            [queryParams]="{ segment: 'femme' }"
            routerLinkActive="active"
          >
            Femme
          </a>

          <div class="nav-dropdown">
            <h4>Pour femme</h4>
            <p class="dropdown-text">
              Sacs, sacoches et ceintures en cuir pour femme.
            </p>
            <div class="dropdown-links">
              <a
                [routerLink]="['/products']"
                [queryParams]="{ segment: 'femme', category: 'sacs-sacoches' }"
              >
                Sacs &amp; sacoches
              </a>
              <a
                [routerLink]="['/products']"
                [queryParams]="{ segment: 'femme', category: 'ceintures' }"
              >
                Ceintures
              </a>
            </div>
          </div>
        </div>

        <!-- PETITE MAROQUINERIE -->
        <div class="nav-item has-dropdown">
          <a
            routerLink="/products"
            [queryParams]="{ segment: 'petite-maroquinerie' }"
            routerLinkActive="active"
          >
            Petite maroquinerie
          </a>

          <div class="nav-dropdown">
            <h4>Petite maroquinerie</h4>
            <p class="dropdown-text">
              Portefeuilles, portes-cartes et sets de table en cuir.
            </p>
            <div class="dropdown-links">
              <a
                [routerLink]="['/products']"
                [queryParams]="{ segment: 'petite-maroquinerie', category: 'portefeuilles' }"
              >
                Portefeuilles
              </a>
              <a
                [routerLink]="['/products']"
                [queryParams]="{ segment: 'petite-maroquinerie', category: 'portes-cartes' }"
              >
                Portes-cartes
              </a>
              <a
                [routerLink]="['/products']"
                [queryParams]="{ segment: 'petite-maroquinerie', category: 'sets-de-table' }"
              >
                Sets de table
              </a>
            </div>
          </div>
        </div>

      </nav>
    </div>

    <!-- BOUTONS Ã€ DROITE -->
    <div class="topbar-right">

      <!-- MINI PANIER -->
      <div
        class="cart-wrapper"
        (mouseenter)="miniCartOpen = true"
        (mouseleave)="miniCartOpen = false"
      >

        <!-- BOUTON PANIER -->
        <button class="cart-button" (click)="goToCart()">
          <span class="cart-icon">ðŸ§º</span>
          <span class="cart-label">Panier</span>
          <span class="cart-badge" *ngIf="cartQuantity > 0">
            {{ cartQuantity }}
          </span>
        </button>

        <!-- POPOVER DU PANIER -->
        <div class="cart-popover" *ngIf="miniCartOpen && (cart$ | async) as cart">

          <h3 class="cart-popover-title">Votre panier</h3>

          <ng-container *ngIf="cart.items.length > 0; else emptyCart">
            <div class="cart-items">

              <div class="cart-item" *ngFor="let item of cart.items">
                <div class="cart-item-left">
                  <div class="cart-thumb" *ngIf="item.imageUrl">
                    <img [src]="item.imageUrl" [alt]="item.name" />
                  </div>

                  <div class="cart-info">
                    <div class="name">{{ item.name }}</div>
                    <div class="meta">
                      x{{ item.quantity }} â€¢ {{ item.unitPrice | currency:'EUR' }}
                    </div>
                  </div>
                </div>

                <div class="cart-item-total">
                  {{ item.lineTotal | currency:'EUR' }}
                </div>
              </div>
            </div>

            <div class="cart-popover-footer">
              <div class="summary">
                <span>{{ cart.totalQuantity }} article(s)</span>
                <span class="total">{{ cart.totalAmount | currency:'EUR' }}</span>
              </div>

              <button class="view-cart-btn" (click)="goToCart()">
                Voir le panier â†’
              </button>
            </div>
          </ng-container>

          <ng-template #emptyCart>
            <p class="empty-text">Votre panier est vide.</p>
          </ng-template>

        </div>

      </div>

      <!-- MON COMPTE -->
      <button class="account-button" routerLink="/profile">
        ðŸ‘¤ Mon compte
      </button>

      <!-- DECONNEXION -->
      <button class="logout-button" (click)="logout()">
        DÃ©connexion
      </button>

    </div>
  </header>

  <!-- ======================= CONTENU DES PAGES ======================= -->
  <main class="page">
    <router-outlet></router-outlet>
  </main>
</div>
