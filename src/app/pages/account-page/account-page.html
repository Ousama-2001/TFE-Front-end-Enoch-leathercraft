<div class="account">

  <h1>Mon compte</h1>

  <!-- TABS -->
  <div class="tabs">
    <button [class.active]="activeTab === 'overview'" (click)="switchTab('overview')">
      Aperçu
    </button>
    <button [class.active]="activeTab === 'profile'" (click)="switchTab('profile')">
      Profil
    </button>
    <button [class.active]="activeTab === 'address'" (click)="switchTab('address')">
      Adresse
    </button>
    <button [class.active]="activeTab === 'orders'" (click)="switchTab('orders')">
      Commandes
    </button>
    <button [class.active]="activeTab === 'security'" (click)="switchTab('security')">
      Sécurité
    </button>
  </div>

  <!-- ALERTS -->
  <p *ngIf="error" class="alert error">{{ error }}</p>
  <p *ngIf="success" class="alert success">{{ success }}</p>

  <!-- OVERVIEW -->
  <div *ngIf="activeTab === 'overview'">
    <h2>Aperçu général</h2>

    <div class="overview-grid">

      <!-- Carte identitée -->
      <div class="card big">
        <h3>{{ profile.firstName }} {{ profile.lastName }}</h3>
        <p>{{ profile.email }}</p>
        <p *ngIf="profile.city || profile.country">
          {{ profile.city }} <span *ngIf="profile.city && profile.country">-</span> {{ profile.country }}
        </p>
        <p *ngIf="!profile.city && !profile.country" class="muted">
          Complétez votre profil pour une expérience optimale.
        </p>
      </div>

      <!-- Nombre de commandes -->
      <div class="card">
        <h3>Total commandes</h3>
        <p class="big-number">{{ myOrders.length }}</p>
      </div>

      <!-- Total dépensé -->
      <div class="card">
        <h3>Total dépensé</h3>
        <p class="big-number">
          {{ totalSpent | currency:'EUR' }}
        </p>
      </div>

      <!-- Dernière commande -->
      <div class="card" *ngIf="myOrders.length; else noOrder">
        <h3>Dernière commande</h3>
        <p>Réf : {{ myOrders[0].reference }}</p>
        <p>{{ myOrders[0].createdAt | date:'dd/MM/yy HH:mm' }}</p>
        <p>Statut : {{ myOrders[0].status }}</p>
      </div>

      <ng-template #noOrder>
        <div class="card">
          <h3>Dernière commande</h3>
          <p class="muted">Vous n'avez pas encore passé de commande.</p>
        </div>
      </ng-template>

    </div>
  </div>

  <!-- PROFIL -->
  <div *ngIf="activeTab === 'profile'" class="card">
    <h2>Informations personnelles</h2>

    <form (ngSubmit)="saveProfile()">
      <div class="grid">
        <label>
          Prénom :
          <input [(ngModel)]="profile.firstName" name="fn">
        </label>

        <label>
          Nom :
          <input [(ngModel)]="profile.lastName" name="ln">
        </label>

        <label>
          Email :
          <input disabled [value]="profile.email">
        </label>

        <label>
          Téléphone :
          <input [(ngModel)]="profile.phone" name="ph">
        </label>
      </div>

      <button class="btn" [disabled]="savingProfile">
        {{ savingProfile ? 'Enregistrement...' : 'Mettre à jour' }}
      </button>
    </form>
  </div>

  <!-- ADRESSE -->
  <div *ngIf="activeTab === 'address'" class="card">
    <h2>Adresse</h2>

    <form (ngSubmit)="saveProfile()">
      <div class="grid">
        <label>
          Adresse :
          <input [(ngModel)]="profile.addressLine1" name="ad">
        </label>

        <label>
          Code postal :
          <input [(ngModel)]="profile.postalCode" name="pc">
        </label>

        <label>
          Ville :
          <input [(ngModel)]="profile.city" name="ct">
        </label>

        <label>
          Pays :
          <input [(ngModel)]="profile.country" name="co">
        </label>
      </div>

      <button class="btn" [disabled]="savingProfile">
        {{ savingProfile ? 'Enregistrement...' : 'Mettre à jour' }}
      </button>
    </form>
  </div>

  <!-- COMMANDES -->
  <div *ngIf="activeTab === 'orders'" class="card">
    <h2>Mes commandes</h2>

    <p *ngIf="loadingOrders">Chargement...</p>

    <table *ngIf="!loadingOrders && myOrders.length">
      <thead>
      <tr>
        <th>Réf</th>
        <th>Date</th>
        <th>Total</th>
        <th>Statut</th>
      </tr>
      </thead>

      <tbody>
      <tr *ngFor="let o of myOrders">
        <td>{{ o.reference }}</td>
        <td>{{ o.createdAt | date:'dd/MM/yy HH:mm' }}</td>
        <td>{{ o.totalAmount | currency:'EUR' }}</td>
        <td>{{ o.status }}</td>
      </tr>
      </tbody>
    </table>

    <p *ngIf="!loadingOrders && !myOrders.length">
      Vous n'avez pas encore de commande.
    </p>
  </div>

  <!-- SÉCURITÉ -->
  <div *ngIf="activeTab === 'security'" class="card">
    <h2>Sécurité</h2>

    <form (ngSubmit)="submitPasswordChange()">
      <label>
        Ancien mot de passe :
        <input type="password" [(ngModel)]="oldPassword" name="old">
      </label>

      <label>
        Nouveau mot de passe :
        <input type="password" [(ngModel)]="newPassword" name="new">
      </label>

      <label>
        Confirmer :
        <input type="password" [(ngModel)]="confirmPassword" name="cnf">
      </label>

      <button class="btn" [disabled]="changingPassword">
        {{ changingPassword ? 'Modification...' : 'Changer le mot de passe' }}
      </button>
    </form>

    <hr>

    <button class="btn danger" (click)="deleteAccount()">
      Supprimer mon compte ❌
    </button>
  </div>

</div>
