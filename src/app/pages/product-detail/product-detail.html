<div class="product-detail-page" *ngIf="product; else loadingOrError">
  <button class="btn-back" type="button" (click)="goBack()">
    ‚Üê Retour aux produits
  </button>

  <!-- ========= CARTE PRODUIT ========= -->
  <div class="product-detail-card">
    <div class="left">
      <div class="image-wrapper">
        <img
          [src]="product.imageUrls && product.imageUrls.length > 0
                  ? ('http://localhost:8080' + product.imageUrls[0])
                  : 'assets/img/products/placeholder-bag.jpg'"
          [alt]="product.name"
        />
      </div>
    </div>

    <div class="right">
      <h1>{{ product.name }}</h1>

      <p class="price">
        {{ product.price | currency : 'EUR' }}
      </p>

      <div class="meta">
        <p *ngIf="product.material">
          <strong>Mat√©riau :</strong> {{ product.material }}
        </p>
        <p *ngIf="product.description">
          {{ product.description }}
        </p>

        <p class="stock-msg stock-warning" *ngIf="!isOutOfStock">
          Stock disponible : {{ stockAvailable }} pi√®ce(s).
        </p>
        <p class="stock-msg stock-error" *ngIf="isOutOfStock">
          Produit actuellement en rupture de stock.
        </p>
      </div>

      <div class="qty-row">
        <button
          type="button"
          class="round-btn"
          (click)="decrease()"
          [disabled]="quantity === 0"
        >
          ‚àí
        </button>

        <span class="qty-label">{{ quantity }}</span>

        <button
          type="button"
          class="round-btn"
          (click)="increase()"
          [disabled]="!canIncrease"
        >
          +
        </button>
      </div>

      <div class="actions">
        <button
          class="btn-cart-animated"
          type="button"
          (click)="addToCart()"
          [disabled]="isOutOfStock || !canIncrease"
        >
          üõí Ajouter au panier
        </button>

        <span class="added-msg" *ngIf="addedMessage">
          {{ addedMessage }}
        </span>
      </div>

      <p class="stock-msg inline-msg" *ngIf="stockMessage">
        {{ stockMessage }}
      </p>
    </div>
  </div>

  <!-- ========= SECTION AVIS PRODUIT ========= -->
  <section class="reviews-section">
    <!-- Colonne gauche : liste des avis -->
    <div class="reviews-card left-card">
      <h2>Avis clients</h2>

      <p *ngIf="reviewsLoading">Chargement des avis...</p>
      <p *ngIf="reviewsError" class="error">{{ reviewsError }}</p>

      <p *ngIf="!reviewsLoading && !reviewsError && reviews.length === 0">
        Aucun avis pour ce produit pour l‚Äôinstant.
      </p>

      <ul
        class="reviews-list"
        *ngIf="!reviewsLoading && !reviewsError && reviews.length > 0"
      >
        <li *ngFor="let r of reviews" class="review-item">
          <div class="review-header">
            <span class="author">{{ r.authorName }}</span>
            <span class="rating">‚òÖ {{ r.rating }}/5</span>
          </div>
          <p class="comment">{{ r.comment }}</p>
          <p class="date">{{ r.createdAt | date:'dd/MM/yyyy √† HH:mm' }}</p>
        </li>
      </ul>
    </div>

    <!-- Colonne droite : formulaire -->
    <div class="reviews-card right-card">
      <h2>Laisser un avis</h2>

      <form (ngSubmit)="submitReview()" class="review-form">
        <div class="form-group">
          <label for="rating">Note</label>
          <select id="rating" name="rating" [(ngModel)]="reviewRating">
            <option [value]="5">5 - Excellent</option>
            <option [value]="4">4 - Tr√®s bon</option>
            <option [value]="3">3 - Correct</option>
            <option [value]="2">2 - Moyen</option>
            <option [value]="1">1 - Mauvais</option>
          </select>
        </div>

        <div class="form-group">
          <label for="comment">Commentaire</label>
          <textarea
            id="comment"
            name="comment"
            rows="3"
            [(ngModel)]="reviewComment"
          ></textarea>
        </div>

        <p *ngIf="reviewError" class="error">{{ reviewError }}</p>
        <p *ngIf="reviewSuccessMsg" class="success">{{ reviewSuccessMsg }}</p>

        <button
          type="submit"
          class="btn-cart-animated"
          [disabled]="reviewSubmitting"
        >
          {{ reviewSubmitting ? 'Envoi en cours...' : 'Envoyer mon avis' }}
        </button>
      </form>
    </div>
  </section>
</div>

<!-- ========= TEMPLATE CHARGEMENT / ERREUR ========= -->
<ng-template #loadingOrError>
  <div class="product-detail-page center">
    <p *ngIf="loading">Chargement du produit...</p>
    <p *ngIf="!loading && error">{{ error }}</p>
  </div>
</ng-template>
