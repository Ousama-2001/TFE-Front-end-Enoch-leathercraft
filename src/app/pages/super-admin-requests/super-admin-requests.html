<div class="requests-page">
  <h2>Demandes & réactivations de compte</h2>
  <p class="subtitle">
    Vue des demandes envoyées par les utilisateurs dont le compte est
    désactivé.
  </p>

  <!-- Résumé -->
  <div class="requests-summary">
    <div class="summary-card">
      <span class="label">Total</span>
      <span class="value">{{ totalCount }}</span>
    </div>
    <div class="summary-card pending">
      <span class="label">En attente</span>
      <span class="value">{{ pendingCount }}</span>
    </div>
    <div class="summary-card handled">
      <span class="label">Traitées</span>
      <span class="value">{{ handledCount }}</span>
    </div>
  </div>

  <p class="info" *ngIf="loading">Chargement des demandes...</p>
  <p class="error" *ngIf="error">{{ error }}</p>

  <p class="info" *ngIf="!loading && !requests.length && !error">
    Aucune demande pour le moment.
  </p>

  <table
    class="requests-table"
    *ngIf="!loading && requests.length > 0"
  >
    <thead>
    <tr>
      <th>ID</th>
      <th>Email</th>
      <th>Créée le</th>
      <th>Statut</th>
      <th>Traité le / par</th>
      <th>Action</th>
    </tr>
    </thead>
    <tbody>
    <tr *ngFor="let r of requests">
      <td>{{ r.id }}</td>
      <td>{{ r.email }}</td>
      <td>{{ r.createdAt | date : 'dd/MM/yyyy HH:mm' }}</td>
      <td>
          <span
            class="status-pill"
            [ngClass]="{ pending: !r.handled, handled: r.handled }"
          >
            {{ r.handled ? 'Traité' : 'En attente' }}
          </span>
      </td>
      <td>
        <ng-container *ngIf="r.handled; else notHandled">
          <div *ngIf="r.handledAt">
            <strong>{{ r.handledAt | date : 'dd/MM/yyyy HH:mm' }}</strong>
          </div>
          <div *ngIf="r.handledBy">
            par <span class="by">{{ r.handledBy }}</span>
          </div>
        </ng-container>
        <ng-template #notHandled>
          <span class="muted">—</span>
        </ng-template>
      </td>
      <td>
        <button
          class="btn-toggle"
          type="button"
          (click)="toggleHandled(r)"
        >
          {{ r.handled ? 'Marquer comme non traité' : 'Marquer comme traité' }}
        </button>
      </td>
    </tr>
    </tbody>
  </table>
</div>
