<div class="wishlist-page">
  <div class="wishlist-inner">
    <!-- HEADER -->
    <div class="wishlist-header">
      <h1>Ma wishlist</h1>
      <p class="subtitle">
        Retrouvez ici les pièces que vous avez ajoutées à vos favoris.
      </p>
    </div>

    <!-- Chargement -->
    <div *ngIf="loading" class="wishlist-loading">
      Chargement de votre wishlist...
    </div>

    <!-- Erreur -->
    <div *ngIf="!loading && error" class="wishlist-empty">
      {{ error }}
    </div>

    <!-- État vide -->
    <div
      *ngIf="!loading && !error && items.length === 0"
      class="wishlist-empty"
    >
      Votre wishlist est vide.
      <a routerLink="/products">Voir les produits</a>
    </div>
    <div class="wishlist-actions" *ngIf="items.length > 0">
      <button class="btn-clear" (click)="clearWishlist()">
        Vider ma wishlist
      </button>
    </div>


    <!-- LISTE DES PRODUITS -->
    <div
      class="wishlist-grid"
      *ngIf="!loading && !error && items.length > 0"
    >
      <article class="wishlist-card" *ngFor="let w of paginatedItems">
        <!-- IMAGE -->
        <div
          class="wishlist-card-image"
          (click)="goToProduct(w.product.id)"
        >
          <img
            [src]="getProductImageUrl(w)"
            [alt]="w.product.name || 'Produit Enoch Leathercraft'"
          />
        </div>

        <!-- CONTENU -->
        <div class="wishlist-card-body">
          <h3 class="wishlist-product-name">
            {{ w.product.name }}
          </h3>

          <p class="wishlist-product-price">
            {{ w.product.price | currency : 'EUR' }}
          </p>
        </div>

        <!-- ACTIONS -->
        <div class="wishlist-card-footer">
          <button
            type="button"
            class="wishlist-remove-btn"
            (click)="remove(w.product.id)"
          >
            Retirer
          </button>

          <button
            type="button"
            class="wishlist-add-cart-btn"
            (click)="addToCart(w)"
            [disabled]="isAddDisabled(w)"
          >
            Ajouter au panier
          </button>
        </div>

        <!-- ✅ MESSAGE STOCK -->
        <p class="wishlist-stock-warning" *ngIf="isMaxQuantityReached(w)">
          Stock maximum atteint pour ce produit.
        </p>
      </article>
    </div>

    <!-- PAGINATION -->
    <div
      class="wishlist-pagination"
      *ngIf="!loading && !error && items.length > pageSize"
    >
      <button
        class="wishlist-page-btn"
        [disabled]="page === 1"
        (click)="changePage(page - 1)"
      >
        ← Précédent
      </button>

      <span class="wishlist-page-info">
        Page {{ page }} / {{ totalPages }}
      </span>

      <button
        class="wishlist-page-btn"
        [disabled]="page === totalPages"
        (click)="changePage(page + 1)"
      >
        Suivant →
      </button>
    </div>
  </div>
</div>
