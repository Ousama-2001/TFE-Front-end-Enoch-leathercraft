<div class="products-page">

  <section class="hero">
    <h1>Enoch Leathercraft</h1>
    <p>D√©couvrez nos sacs, sacoches, ceintures et portefeuilles faits main.</p>
  </section>

  <!-- BARRE DE FILTRES -->
  <section class="filters">
    <div class="filter-row">

      <div class="filter-group">
        <label>Recherche</label>
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (ngModelChange)="onFiltersChange()"
          placeholder="Rechercher un produit..."
        />
      </div>

      <div class="filter-group">
        <label>Univers</label>
        <select [(ngModel)]="selectedSegment" (ngModelChange)="onFiltersChange()">
          <option value="">Tous</option>
          <option value="homme">Homme</option>
          <option value="femme">Femme</option>
          <option value="petite-maroquinerie">Petite maroquinerie</option>
        </select>
      </div>

      <div class="filter-group">
        <label>Cat√©gorie</label>
        <select [(ngModel)]="selectedCategory" (ngModelChange)="onFiltersChange()">
          <option value="">Toutes</option>
          <option value="sacs-sacoches">Sacs & sacoches</option>
          <option value="ceintures">Ceintures</option>
          <option value="portefeuilles">Portefeuilles</option>
          <option value="portes-cartes">Portes-cartes</option>
          <option value="sets-de-table">Sets de table</option>
        </select>
      </div>

      <div class="filter-group filter-price">
        <label>Prix (‚Ç¨)</label>
        <div class="filter-price-inputs">
          <input
            type="number"
            [(ngModel)]="priceMin"
            (ngModelChange)="onFiltersChange()"
            placeholder="Min"
          />
          <span>‚Äî</span>
          <input
            type="number"
            [(ngModel)]="priceMax"
            (ngModelChange)="onFiltersChange()"
            placeholder="Max"
          />
        </div>
      </div>

    </div>
  </section>

  <section
    class="products-section"
    *ngIf="filteredProducts && filteredProducts.length; else noProducts"
  >
    <h2 class="section-title">Nos produits</h2>

    <div class="products-grid">
      <article class="product-card" *ngFor="let p of paginatedProducts">

        <div class="product-image">
          <img
            [src]="p.imageUrls && p.imageUrls.length > 0
                  ? ('http://localhost:8080' + p.imageUrls[0])
                  : 'assets/img/products/placeholder-bag.jpg'"
            [alt]="p.name"
          />
        </div>

        <div class="product-body">
          <h3 class="product-name">{{ p.name }}</h3>

          <p class="product-description" *ngIf="p.description; else noDesc">
            {{ p.description }}
          </p>
          <ng-template #noDesc>
            <p class="product-description muted">
              Description √† venir.
            </p>
          </ng-template>
        </div>

        <div class="card-footer">
          <div class="price">
            {{ p.price | currency : 'EUR' }}
          </div>

          <div class="card-actions">
            <ng-container *ngIf="getQuantity(p) === 0; else qtyControls">
              <button
                type="button"
                class="btn-icon btn-cart"
                (click)="increase(p)"
                aria-label="Ajouter au panier"
              >
                üõí
              </button>
            </ng-container>

            <ng-template #qtyControls>
              <div class="qty-pill">
                <button type="button" (click)="decrease(p)">‚àí</button>
                <span>{{ getQuantity(p) }}</span>
                <button type="button" (click)="increase(p)">+</button>
              </div>
            </ng-template>

            <a
              class="btn-icon btn-eye"
              [routerLink]="['/products', p.id]"
              aria-label="Voir le produit"
            >
              üëÅÔ∏è
            </a>
          </div>
        </div>
      </article>
    </div>

    <div class="pagination" *ngIf="totalPages > 1">
      <button
        class="page-btn"
        [disabled]="page === 1"
        (click)="changePage(page - 1)"
      >
        ‚Üê Pr√©c√©dent
      </button>

      <span class="page-info">
        Page {{ page }} / {{ totalPages }}
      </span>

      <button
        class="page-btn"
        [disabled]="page === totalPages"
        (click)="changePage(page + 1)"
      >
        Suivant ‚Üí
      </button>
    </div>
  </section>

  <ng-template #noProducts>
    <p class="empty-message">Aucun produit disponible pour le moment.</p>
  </ng-template>
</div>
