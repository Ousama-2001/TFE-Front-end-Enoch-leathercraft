<div class="admin-dashboard">

  <h1>Tableau de bord administrateur</h1>
  <p class="subtitle">
    Vue d’ensemble des ventes et du stock pour Enoch Leathercraft.
  </p>

  <!-- ================== CARTES STATS ================== -->
  <section class="stats-section">

    <div class="stats-row" *ngIf="!statsLoading && stats; else statsLoadingTpl">

      <article class="stat-card">
        <h3>Chiffre d’affaires total</h3>
        <p class="value">
          {{ stats.totalRevenue | currency:'EUR' }}
        </p>
        <p class="hint">Toutes commandes confondues</p>
      </article>

      <article class="stat-card">
        <h3>Nombre de commandes</h3>
        <p class="value">
          {{ stats.totalOrders }}
        </p>
        <p class="hint">Commandes enregistrées</p>
      </article>

      <article class="stat-card">
        <h3>Articles vendus</h3>
        <p class="value">
          {{ stats.totalItemsSold }}
        </p>
        <p class="hint">Total des pièces vendues</p>
      </article>

      <article class="stat-card">
        <h3>Panier moyen</h3>
        <p class="value">
          {{ stats.averageOrderValue | currency:'EUR' }}
        </p>
        <p class="hint">Montant moyen par commande</p>
      </article>

    </div>

    <ng-template #statsLoadingTpl>
      <p class="info">Chargement des statistiques...</p>
    </ng-template>

    <p class="error" *ngIf="statsError">{{ statsError }}</p>

  </section>

  <!-- ================== STOCK FAIBLE ================== -->
  <section class="stock-section">

    <div class="stock-header">
      <h2>Produits en stock faible</h2>

      <div class="threshold-control">
        <label for="threshold">Seuil d’alerte :</label>
        <input
          id="threshold"
          type="number"
          min="0"
          [(ngModel)]="lowStockThreshold"
          (ngModelChange)="onThresholdChange()"
        />
      </div>
    </div>

    <p class="info" *ngIf="lowStockLoading">Chargement des produits en stock faible...</p>
    <p class="error" *ngIf="lowStockError">{{ lowStockError }}</p>

    <table class="stock-table" *ngIf="!lowStockLoading && lowStockProducts.length > 0">
      <thead>
      <tr>
        <th>Produit</th>
        <th>SKU</th>
        <th>Prix</th>
        <th>Stock actuel</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let p of lowStockProducts">
        <td>{{ p.name }}</td>
        <td>{{ p.sku }}</td>
        <td>{{ p.price | currency:'EUR' }}</td>
        <td class="stock-cell">{{ p.stockQuantity ?? 0 }}</td>
      </tr>
      </tbody>
    </table>

    <p class="info" *ngIf="!lowStockLoading && !lowStockProducts.length">
      Aucun produit en dessous du seuil de {{ lowStockThreshold }} unités.
    </p>

  </section>

</div>
<!-- ================== COMMANDES ================== -->
<section class="orders-section">

  <div class="orders-header">
    <h2>Dernières commandes</h2>
    <p class="hint">Vue globale des commandes clients (côté administrateur).</p>
  </div>

  <p class="info" *ngIf="ordersLoading">Chargement des commandes...</p>
  <p class="error" *ngIf="ordersError">{{ ordersError }}</p>

  <table class="orders-table" *ngIf="!ordersLoading && orders.length > 0">
    <thead>
    <tr>
      <th>Référence</th>
      <th>Date</th>
      <th>Statut</th>
      <th>Montant</th>
      <th>Détails</th>
    </tr>
    </thead>
    <tbody>
    <tr *ngFor="let o of orders">
      <td>{{ o.reference }}</td>
      <td>{{ o.createdAt | date:'dd/MM/yyyy HH:mm' }}</td>
      <td>
          <span class="status-pill" [ngClass]="o.status.toLowerCase()">
            {{ o.status }}
          </span>
      </td>
      <td>{{ o.totalAmount | currency:'EUR' }}</td>
      <td>
        <details class="order-details">
          <summary>Voir les articles</summary>
          <ul>
            <li *ngFor="let item of o.items">
              {{ item.quantity }} × {{ item.productName }}
              ({{ item.unitPrice | currency:'EUR' }})
            </li>
          </ul>
        </details>
      </td>
    </tr>
    </tbody>
  </table>

  <p class="info" *ngIf="!ordersLoading && !orders.length">
    Aucune commande pour le moment.
  </p>

</section>

