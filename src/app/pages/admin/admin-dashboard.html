<div class="admin-dashboard">

  <div class="admin-header">
    <div class="left">
      <h1>Tableau de bord administrateur</h1>
      <p class="subtitle">Gestion globale de la boutique Enoch Leathercraft.</p>
    </div>
  </div>

  <div class="admin-tabs">
    <button class="tab-btn" [class.active]="activeTab === 'stats'" (click)="setTab('stats')">Stats</button>
    <button class="tab-btn" [class.active]="activeTab === 'orders'" (click)="setTab('orders')">Commandes</button>
    <button class="tab-btn" [class.active]="activeTab === 'returns'" (click)="setTab('returns')">Retours</button>
    <button class="tab-btn" [class.active]="activeTab === 'products'" (click)="setTab('products')">Produits</button>
    <button class="tab-btn" [class.active]="activeTab === 'promotions'" (click)="setTab('promotions')">Coupons</button>
    <button class="tab-btn" [class.active]="activeTab === 'stock'" (click)="setTab('stock')">Stock</button>
    <button class="tab-btn" [class.active]="activeTab === 'reviews'" (click)="setTab('reviews')">Avis</button>
    <button class="tab-btn" [class.active]="activeTab === 'support'" *ngIf="isAdminOrSuperAdmin" (click)="setTab('support')">Contact</button>

    <button *ngIf="isSuperAdmin" class="tab-btn" [class.active]="activeTab === 'users'" (click)="setTab('users')">Utilisateurs</button>
    <button *ngIf="isSuperAdmin" class="tab-btn" [class.active]="activeTab === 'requests'" (click)="setTab('requests')">Demandes</button>
  </div>

  <div class="admin-content">

    <section *ngIf="activeTab === 'stats'" class="panel">
      <div class="panel-head"><h2>Statistiques</h2></div>
      <div *ngIf="statsLoading" class="muted">Chargement‚Ä¶</div>
      <div *ngIf="statsError" class="error">{{ statsError }}</div>

      <div *ngIf="stats" class="grid-3">
        <div class="kpi">
          <div class="kpi-label">Chiffre d‚Äôaffaires</div>
          <div class="kpi-value">{{ stats.totalRevenue | currency:'EUR' }}</div>
        </div>
        <div class="kpi">
          <div class="kpi-label">Commandes</div>
          <div class="kpi-value">{{ stats.totalOrders }}</div>
        </div>
        <div class="kpi">
          <div class="kpi-label">Panier moyen</div>
          <div class="kpi-value">{{ stats.averageOrderValue | currency:'EUR' }}</div>
        </div>
      </div>
    </section>

    <section *ngIf="activeTab === 'orders'" class="panel">
      <div class="panel-head">
        <h2>Commandes</h2>
        <div class="filters">
          <input type="text" [(ngModel)]="orderSearchTerm" placeholder="üîç R√©f..." class="search-input" />
          <div class="filter-select-wrapper">
            <select [(ngModel)]="orderStatusFilter">
              <option value="ALL">Tous les statuts</option>
              <option *ngFor="let s of orderStatusOptions" [value]="s.value">{{ s.label }}</option>
            </select>
          </div>
        </div>
      </div>

      <div *ngIf="ordersLoading" class="muted">Chargement‚Ä¶</div>
      <div class="table-wrap" *ngIf="!ordersLoading">
        <table class="table">
          <thead>
          <tr>
            <th>R√©f</th>
            <th>Date</th>
            <th>Client</th>
            <th>Total</th>
            <th>Statut</th>
            <th></th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let o of paginatedOrders">
            <td class="mono" [class.highlight]="orderSearchTerm && o.reference.toLowerCase().includes(orderSearchTerm.toLowerCase())">{{ o.reference }}</td>
            <td>{{ o.createdAt | date:'dd/MM/yyyy HH:mm' }}</td>
            <td>{{ getOrderEmail(o) }}</td>
            <td>{{ o.totalAmount | currency:'EUR' }}</td>
            <td><span class="status-pill" [ngClass]="getStatusClass(o.status)">{{ getStatusLabel(o.status) }}</span></td>
            <td class="right"><button class="btn small" (click)="openOrderModal(o)">D√©tails</button></td>
          </tr>
          </tbody>
        </table>
        <div class="pagination-controls" *ngIf="filteredOrders.length > pageSize">
          <button class="btn small ghost" (click)="changeOrdersPage(-1)" [disabled]="ordersPage === 1">‚Üê</button>
          <span class="page-info">{{ ordersPage }} / {{ totalOrdersPages }}</span>
          <button class="btn small ghost" (click)="changeOrdersPage(1)" [disabled]="ordersPage === totalOrdersPages">‚Üí</button>
        </div>
      </div>
    </section>

    <section *ngIf="activeTab === 'returns'" class="panel">
      <div class="panel-head">
        <h2>Gestion des Retours</h2>
        <div class="filters">
          <input type="text" [(ngModel)]="returnSearchTerm" placeholder="üîç R√©f..." class="search-input" />
          <div class="filter-select-wrapper">
            <select [(ngModel)]="returnStatusFilter">
              <option value="ALL">Tous les retours</option>
              <option *ngFor="let s of returnStatusOptions" [value]="s.value">{{ s.label }}</option>
            </select>
          </div>
        </div>
      </div>

      <div class="table-wrap">
        <table class="table">
          <thead><tr><th>R√©f</th><th>Date</th><th>Client</th><th>Total</th><th>Statut</th><th></th></tr></thead>
          <tbody>
          <tr *ngFor="let o of paginatedReturns">
            <td class="mono" [class.highlight]="returnSearchTerm && o.reference.toLowerCase().includes(returnSearchTerm.toLowerCase())">{{ o.reference }}</td>
            <td>{{ o.createdAt | date:'dd/MM/yyyy HH:mm' }}</td>
            <td>{{ getOrderEmail(o) }}</td>
            <td>{{ o.totalAmount | currency:'EUR' }}</td>
            <td><span class="status-pill" [ngClass]="getStatusClass(o.status)">{{ getStatusLabel(o.status) }}</span></td>
            <td class="right">
              <div class="row-actions" style="justify-content:flex-end;">
                <button class="btn small" (click)="openReturnDetails(o)">G√©rer</button>
              </div>
            </td>
          </tr>
          </tbody>
        </table>
        <div class="pagination-controls" *ngIf="filteredReturns.length > pageSize">
          <button class="btn small ghost" (click)="changeReturnsPage(-1)" [disabled]="returnsPage === 1">‚Üê</button>
          <span class="page-info">{{ returnsPage }} / {{ totalReturnsPages }}</span>
          <button class="btn small ghost" (click)="changeReturnsPage(1)" [disabled]="returnsPage === totalReturnsPages">‚Üí</button>
        </div>
      </div>
    </section>

    <section *ngIf="activeTab === 'products'" class="panel">
      <div class="panel-head">
        <h2>Produits</h2>
        <div class="products-toolbar">
          <div class="search-box">
            <input type="text" [(ngModel)]="productSearchTerm" placeholder="üîç SKU ou Nom..." />
          </div>
          <div class="divider-v"></div>
          <div class="filter-select-wrapper">
            <select [(ngModel)]="selectedProductFilter" (change)="onProductFilterChange()">
              <option value="ALL">Tous les produits</option>
              <option value="ACTIVE">Produits actifs</option>
              <option value="PROMO">En promotion</option>
              <option value="ARCHIVED">Archiv√©s / Inactifs</option>
            </select>
          </div>
          <button class="btn small primary new-btn" *ngIf="selectedProductFilter !== 'ARCHIVED'" (click)="toggleCreateForm()">
            {{ showCreateForm ? 'Fermer' : '+ Nouveau' }}
          </button>
        </div>
      </div>

      <div class="card dark" id="product-form-panel" *ngIf="showCreateForm">
        <div class="form-title-row">
          <h3 style="margin:0;">{{ editingProductId ? 'Modifier le produit' : 'Cr√©er un produit' }}</h3>
          <span class="pill pill-soft">{{ editingProductId ? '√âdition' : 'Nouveau' }}</span>
        </div>

        <div *ngIf="productFormError" class="alert error" style="margin-top: 15px;">
          ‚ö†Ô∏è {{ productFormError }}
        </div>

        <div class="row-2">
          <div><label>Nom <span class="req">*</span></label><input [(ngModel)]="newProduct.name" placeholder="Nom du produit" [class.input-error]="!newProduct.name && productFormError" /></div>
          <div>
            <label>SKU <span class="req">*</span></label>
            <div class="row-actions" style="justify-content:flex-start; gap:8px; align-items:center;">
              <input [(ngModel)]="newProduct.sku" (input)="onSkuManualInput()" placeholder="SKU" [class.input-error]="!newProduct.sku && productFormError" />
              <button type="button" class="btn small ghost" (click)="resetSkuAuto()">Auto</button>
            </div>
          </div>
        </div>

        <div class="row-2">
          <div>
            <label>Segment <span class="req">*</span></label>
            <select [(ngModel)]="newProduct.segmentCategoryId" (change)="onSegmentChange()" [class.input-error]="!newProduct.segmentCategoryId && productFormError">
              <option [ngValue]="null">Choix...</option>
              <option *ngFor="let s of segmentOptions" [ngValue]="s.id">{{ s.label }}</option>
            </select>
          </div>
          <div>
            <label>Type <span class="req">*</span></label>
            <select [(ngModel)]="newProduct.typeCategoryId" (change)="onTypeChange()" [class.input-error]="!newProduct.typeCategoryId && productFormError">
              <option [ngValue]="null">Choix...</option>
              <option *ngFor="let t of filteredTypeOptions" [ngValue]="t.id">{{ t.label }}</option>
            </select>
          </div>
        </div>

        <div class="row-2">
          <div><label>Prix (‚Ç¨) <span class="req">*</span></label><input type="number" min="0" [(ngModel)]="newProduct.price" placeholder="0.00" [class.input-error]="newProduct.price == null && productFormError" /></div>
          <div><label>Poids (g)</label><input type="number" min="0" [(ngModel)]="newProduct.weightGrams" placeholder="0" /></div>
        </div>

        <label>Description</label>
        <div class="textarea-wrapper">
            <textarea
              [(ngModel)]="newProduct.description"
              rows="4"
              maxlength="1000"
              placeholder="Description du produit..."
              [class.input-error]="newProduct.description && newProduct.description.length > 1000">
            </textarea>
          <div class="char-count" [class.limit-reached]="(newProduct.description?.length || 0) >= 1000">
            {{ newProduct.description?.length || 0 }} / 1000
          </div>
        </div>

        <div class="divider"></div>
        <div class="section-head" style="margin-bottom: 10px; display:flex; align-items:center; justify-content:space-between;">
          <h4 style="margin:0;">Promotion</h4>
          <button class="btn small" type="button" [ngClass]="hasPromo ? 'danger' : 'ghost'" style="border:1px solid currentColor;" (click)="togglePromo()">
            {{ hasPromo ? 'D√©sactiver la promo' : 'Activer une promo' }}
          </button>
        </div>

        <div *ngIf="hasPromo" class="promo-box">
          <div class="row-2">
            <div><label>Prix promo (‚Ç¨) <span class="req">*</span></label><input type="number" min="0" [(ngModel)]="newProduct.promoPrice" placeholder="0.00" [class.input-error]="newProduct.promoPrice == null && productFormError" /></div>
            <div><label>D√©but <span class="req">*</span></label><input type="date" [(ngModel)]="newProduct.promoStartAt" [class.input-error]="!newProduct.promoStartAt && productFormError" /></div>
            <div><label>Fin</label><input type="date" [(ngModel)]="newProduct.promoEndAt" /></div>
          </div>
        </div>

        <div class="divider"></div>
        <div class="section-head"><h4 style="margin:0;">Images</h4></div>
        <div class="image-upload-area">
          <input type="file" multiple (change)="onFilesSelected($event)" id="fileInput" class="hidden-input"/>
          <label for="fileInput" class="upload-btn"><span>+ Ajouter des images</span></label>
        </div>
        <div class="admin-img-grid">
          <div class="admin-img-thumb" *ngFor="let img of currentImages">
            <img [src]="img.url" alt="Produit" (click)="openImagePreview(img.url)">
            <div class="overlay"><span class="badge-old">En ligne</span></div>
            <button type="button" class="x-remove" (click)="deleteExistingImage(img.id)">√ó</button>
          </div>
          <div class="admin-img-thumb new" *ngFor="let p of selectedPreviews; let i = index">
            <img [src]="p" alt="Preview" (click)="openImagePreview(p)">
            <button type="button" class="x-remove" (click)="removeSelectedFile(i)">√ó</button>
          </div>
        </div>

        <div class="row-actions" style="margin-top:20px;">
          <button class="btn primary" (click)="submitForm()" [disabled]="isSubmitting">
            {{ editingProductId ? 'Enregistrer' : 'Cr√©er le produit' }}
          </button>
          <button class="btn ghost" type="button" (click)="toggleCreateForm()">Annuler</button>
        </div>
      </div>

      <div class="table-wrap" *ngIf="!loading">
        <table class="table">
          <thead><tr><th>Image</th><th>Nom</th><th>SKU</th><th>Prix</th><th>Stock</th><th>Statut Promo</th><th>Action</th></tr></thead>
          <tbody>
          <tr *ngFor="let p of paginatedProducts">
            <td class="product-thumb">
              <img *ngIf="p.imageUrls && p.imageUrls.length" [src]="'http://localhost:8080' + p.imageUrls[0]" style="width:40px;height:40px;object-fit:cover;border-radius:6px;cursor:pointer;" (click)="openImagePreview('http://localhost:8080' + p.imageUrls[0])">
            </td>
            <td>{{ p.name }}</td>
            <td class="mono" [class.highlight]="productSearchTerm && p.sku.toLowerCase().includes(productSearchTerm.toLowerCase())">{{ p.sku }}</td>
            <td>
              <div *ngIf="p.promoPrice && p.promoPrice > 0; else simplePrice">
                <span class="old-price">{{ p.price | currency:'EUR' }}</span><br>
                <span class="promo-price-tag">{{ p.promoPrice | currency:'EUR' }}</span>
              </div>
              <ng-template #simplePrice>{{ p.price | currency:'EUR' }}</ng-template>
            </td>
            <td><span class="pill pill-soft">{{ p.stockQuantity ?? 0 }}</span></td>
            <td><span class="pill" [ngClass]="getPromoStatusClass(p)">{{ getPromoStatusLabel(p) }}</span></td>
            <td class="right">
              <div class="row-actions" style="justify-content:flex-end;">
                <button class="btn small" *ngIf="selectedProductFilter !== 'ARCHIVED'" (click)="startEdit(p)">√âditer</button>
                <button class="btn small danger" *ngIf="selectedProductFilter !== 'ARCHIVED'" (click)="openDeleteConfirm(p)">Archiver</button>
                <button class="btn small ok" *ngIf="selectedProductFilter === 'ARCHIVED'" (click)="restoreProduct(p)">Restaurer</button>
              </div>
            </td>
          </tr>
          </tbody>
        </table>
        <div class="pagination-controls" *ngIf="filteredProducts.length > pageSize">
          <button class="btn small ghost" (click)="changeProductsPage(-1)" [disabled]="productsPage === 1">‚Üê</button>
          <span class="page-info">{{ productsPage }} / {{ totalProductsPages }}</span>
          <button class="btn small ghost" (click)="changeProductsPage(1)" [disabled]="productsPage === totalProductsPages">‚Üí</button>
        </div>
      </div>
    </section>

    <section *ngIf="activeTab === 'promotions'" class="panel">
      <div class="panel-head"><h2>Gestion des Coupons</h2></div>

      <div class="promo-layout">
        <div class="card dark form-section">
          <div class="form-title-row">
            <h3>{{ editingCouponId ? 'Modifier le coupon' : 'Nouveau coupon' }}</h3>
          </div>

          <div class="form-group">
            <label>Code <span class="req">*</span></label>
            <input [(ngModel)]="couponForm.code" placeholder="EX: NOEL20" [class.input-error]="couponErrors['code']" />
            <div class="field-error" *ngIf="couponErrors['code']">{{ couponErrors['code'] }}</div>
          </div>

          <div class="row-2">
            <div class="form-group">
              <label>R√©duction (%) <span class="req">*</span></label>
              <input type="number" min="1" max="100" [(ngModel)]="couponForm.percent" [class.input-error]="couponErrors['percent']" />
              <div class="field-error" *ngIf="couponErrors['percent']">{{ couponErrors['percent'] }}</div>
            </div>
            <div class="form-group">
              <label>Statut</label>
              <select [(ngModel)]="couponForm.active">
                <option [ngValue]="true">Actif</option>
                <option [ngValue]="false">Inactif</option>
              </select>
            </div>
          </div>

          <div class="row-2">
            <div class="form-group">
              <label>Date de D√©but</label>
              <input type="date" [(ngModel)]="couponForm.startsAt" [class.input-error]="couponErrors['dates']" />
            </div>
            <div class="form-group">
              <label>Date de Fin</label>
              <input type="date" [(ngModel)]="couponForm.endsAt" [class.input-error]="couponErrors['dates']" />
            </div>
          </div>
          <div class="field-error" *ngIf="couponErrors['dates']" style="margin-top:-10px; margin-bottom:15px;">{{ couponErrors['dates'] }}</div>

          <div class="form-group">
            <label>Limite d'utilisations (laisser vide pour illimit√©)</label>
            <input type="number" min="0" [(ngModel)]="couponForm.maxUses" placeholder="Ex: 100" />
          </div>

          <div class="row-actions">
            <button class="btn primary" (click)="submitCouponForm()" [disabled]="couponSubmitting">
              {{ editingCouponId ? 'Mettre √† jour' : 'Cr√©er' }}
            </button>
            <button class="btn ghost" (click)="resetCouponForm()">Annuler / Reset</button>
          </div>
        </div>

        <div class="card dark list-section">
          <div class="section-head"><h3>Liste des coupons</h3></div>
          <div class="table-wrap">
            <table class="table">
              <thead>
              <tr>
                <th>Code</th>
                <th>R√©duction</th>
                <th>Usages</th>
                <th>Validit√©</th>
                <th>Statut</th>
                <th></th>
              </tr>
              </thead>
              <tbody>
              <tr *ngFor="let c of coupons">
                <td class="mono code-cell">{{ c.code }}</td>
                <td><b>-{{ c.percent }}%</b></td>
                <td>
                  <span *ngIf="c.maxUses; else unlimited">
                    {{ c.usedCount || 0 }} / {{ c.maxUses }}
                  </span>
                  <ng-template #unlimited>{{ c.usedCount || 0 }} / ‚àû</ng-template>
                </td>
                <td class="small-text">
                  <div *ngIf="c.startsAt">Du {{ c.startsAt | date:'dd/MM/yy' }}</div>
                  <div *ngIf="c.endsAt">Au {{ c.endsAt | date:'dd/MM/yy' }}</div>
                  <div *ngIf="!c.startsAt && !c.endsAt" class="muted">Illimit√©</div>
                </td>
                <td><span class="pill" [ngClass]="getCouponStatusClass(c)">{{ getCouponStatusLabel(c) }}</span></td>
                <td class="right">
                  <div class="row-actions small-gap">
                    <button class="btn-icon edit" (click)="editCoupon(c)" title="Modifier">‚úèÔ∏è</button>
                    <button class="btn-icon delete" (click)="deleteCoupon(c)" title="Supprimer">üóëÔ∏è</button>
                  </div>
                </td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <section *ngIf="activeTab === 'stock'" class="panel">
      <div class="panel-head">
        <h2>Gestion Stock</h2>
        <div class="filters">
          <label class="muted small" style="margin-right:8px;">Seuil alerte</label>
          <input type="number" min="0" style="width:80px;" [(ngModel)]="lowStockThreshold" (input)="onThresholdChange()" />
        </div>
      </div>
      <div class="table-wrap">
        <table class="table">
          <thead><tr><th>SKU</th><th>Nom</th><th>Stock</th><th>Action</th></tr></thead>
          <tbody>
          <tr *ngFor="let p of lowStockProducts">
            <td class="mono">{{ p.sku }}</td>
            <td>{{ p.name }}</td>
            <td style="width:120px;"><input type="number" min="0" [(ngModel)]="p.stockQuantity" /></td>
            <td class="right"><button class="btn small primary" (click)="saveStock(p)">Sauvegarder</button></td>
          </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section *ngIf="activeTab === 'reviews'" class="panel"><app-admin-reviews></app-admin-reviews></section>
    <section *ngIf="activeTab === 'support'" class="panel"><app-super-admin-contact-messages></app-super-admin-contact-messages></section>
    <section *ngIf="activeTab === 'users'" class="panel"><app-super-admin-users></app-super-admin-users></section>
    <section *ngIf="activeTab === 'requests'" class="panel"><app-super-admin-requests></app-super-admin-requests></section>

  </div>

  <div class="modal-backdrop" *ngIf="showDeleteConfirm">
    <div class="modal">
      <h3>Archiver ?</h3>
      <p>Confirmer l'archivage de <b>{{ deleteTargetName }}</b> ?</p>
      <div class="modal-actions">
        <button class="btn ghost" (click)="cancelDelete()">Annuler</button>
        <button class="btn danger" (click)="confirmDelete()">Confirmer</button>
      </div>
    </div>
  </div>

  <div class="modal-backdrop" *ngIf="showOrderModal && selectedOrder">
    <div class="modal wide">
      <div class="modal-top">
        <h3>Commande {{ selectedOrder.reference }}</h3>
        <button class="xclose" (click)="closeOrderModal()">√ó</button>
      </div>
      <div class="divider"></div>
      <div class="row-2" style="margin-bottom: 20px;">
        <div class="kpi" style="background:rgba(99,102,241,0.1); border:1px solid rgba(99,102,241,0.3);">
          <div class="kpi-label">Client</div>
          <div style="font-size:1.1em; font-weight:bold; color:white;">{{ getOrderEmail(selectedOrder) }}</div>
          <div class="muted small" *ngIf="(selectedOrder | any)?.userId">ID: {{ (selectedOrder | any)?.userId }}</div>
        </div>
        <div class="kpi">
          <div class="kpi-label">Total</div>
          <div class="kpi-value">{{ selectedOrder.totalAmount | currency:'EUR' }}</div>
        </div>
      </div>
      <div class="row-2">
        <div>
          <label>Statut Actuel</label>
          <select [(ngModel)]="modalStatus">
            <option *ngFor="let s of orderStatusOptions" [value]="s.value">{{ s.label }}</option>
          </select>
        </div>
        <div>
          <label>Date Commande</label>
          <div class="muted" style="margin-top:10px;">{{ selectedOrder.createdAt | date:'dd/MM/yyyy √† HH:mm' }}</div>
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn ghost" (click)="closeOrderModal()">Fermer</button>
        <button class="btn primary" (click)="saveOrderStatusFromModal()">Mettre √† jour</button>
      </div>
    </div>
  </div>

  <div class="modal-backdrop" *ngIf="showReturnDetailsModal && selectedReturnOrder">
    <div class="modal wide">
      <div class="modal-top">
        <h3>Retour {{ selectedReturnOrder.reference }}</h3>
        <button class="xclose" (click)="closeReturnDetails()">√ó</button>
      </div>
      <div class="divider"></div>
      <div class="row-2" style="margin-bottom: 20px;">
        <div class="kpi" style="background:rgba(234, 88, 12, 0.1); border:1px solid rgba(234, 88, 12, 0.3);">
          <div class="kpi-label">Client</div>
          <div style="font-size:1.1em; font-weight:bold; color:white;">{{ getOrderEmail(selectedReturnOrder) }}</div>
        </div>
        <div class="kpi">
          <div class="kpi-label">Statut Retour</div>
          <div class="kpi-value">{{ selectedReturnOrder.status }}</div>
        </div>
      </div>
      <div class="row-2">
        <div>
          <label>Modifier le statut du retour</label>
          <select [(ngModel)]="modalStatus">
            <option *ngFor="let s of returnStatusOptions" [value]="s.value">{{ s.label }}</option>
          </select>
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn ghost" (click)="closeReturnDetails()">Fermer</button>
        <button class="btn primary" (click)="saveReturnStatusFromModal()">Enregistrer</button>
      </div>
    </div>
  </div>

  <div class="modal-backdrop" *ngIf="showRejectModal">
    <div class="modal">
      <h3>Refuser le retour</h3>
      <label>Raison</label>
      <textarea [(ngModel)]="rejectReason" rows="3"></textarea>
      <div class="modal-actions">
        <button class="btn ghost" (click)="closeRejectModal()">Annuler</button>
        <button class="btn danger" (click)="confirmReject()">Refuser</button>
      </div>
    </div>
  </div>

  <div class="image-preview-overlay" *ngIf="previewImage" (click)="closeImagePreview()">
    <div class="preview-content" (click)="$event.stopPropagation()">
      <img [src]="previewImage" alt="Full Preview">
      <button class="close-preview" (click)="closeImagePreview()">√ó</button>
    </div>
  </div>

</div>
