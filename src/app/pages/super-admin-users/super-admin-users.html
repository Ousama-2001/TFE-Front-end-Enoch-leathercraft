<div class="sa-users-page">
  <header class="page-header">
    <div class="title-block">
      <h1>{{ 'admin.users.title' | t }}</h1>
      <p>{{ 'admin.users.hint' | t }}</p>
    </div>

    <div class="header-tools">
      <div class="filter-select-wrapper">
        <select [(ngModel)]="roleFilter" (change)="onFilterChange()">
          <option value="ALL">{{ 'products.filters.segment.all' | t }} (Roles)</option>
          <option value="SUPER_ADMIN">Super Admin</option>
          <option value="ADMIN">Admin</option>
          <option value="CUSTOMER">User</option>
        </select>
      </div>

      <div class="search-box">
        <span class="search-icon">üîç</span>
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (input)="onFilterChange()"
          [placeholder]="'products.search.placeholder' | t"
        />
      </div>

      <div class="stats-chip" *ngIf="users.length">
        <span class="label">Total:</span>
        <span class="value">{{ filteredUsers.length }}</span>
      </div>
    </div>
  </header>

  <div class="status-filters">
    <button type="button" class="filter-pill" [class.active]="statusFilter === 'all'" (click)="setStatusFilter('all')">
      {{ 'products.filters.segment.all' | t }}
    </button>
    <button type="button" class="filter-pill" [class.active]="statusFilter === 'active'" (click)="setStatusFilter('active')">
      {{ 'admin.users.status.active' | t }}
    </button>
    <button type="button" class="filter-pill" [class.active]="statusFilter === 'deleted'" (click)="setStatusFilter('deleted')">
      {{ 'admin.users.status.deleted' | t }}
    </button>
  </div>

  <section class="users-grid" *ngIf="!loading && filteredUsers.length">
    <article class="user-card" *ngFor="let u of paginatedUsers" [class.user-deleted]="isDeleted(u)">
      <div class="role-strip" [ngClass]="u.role.toLowerCase()">
        <span class="strip-label">{{ getRoleLabel(u.role) }}</span>
      </div>

      <div class="user-card-body">
        <div class="user-header">
          <div class="avatar"><span>{{ getDisplayName(u) | slice:0:1 | uppercase }}</span></div>
          <div class="identity">
            <h3>{{ getDisplayName(u) }}</h3>
            <p class="email">{{ u.email }}</p>
            <p class="username" *ngIf="u.username">@{{ u.username }}</p>
          </div>
        </div>

        <div class="meta">
          <div class="meta-row"><span class="label">{{ 'account.profile.firstName' | t }}</span><span class="value">{{ u.firstName || '‚Äî' }}</span></div>
          <div class="meta-row"><span class="label">{{ 'account.profile.lastName' | t }}</span><span class="value">{{ u.lastName || '‚Äî' }}</span></div>
          <div class="meta-row"><span class="label">{{ 'account.security.title' | t }}</span><span class="value">{{ getRoleLabel(u.role) }}</span></div>
          <div class="meta-row"><span class="label">{{ 'account.orders.date' | t }}</span><span class="value">{{ u.createdAt | date:'dd/MM/yyyy' }}</span></div>
        </div>

        <div class="actions">
          <button type="button" class="btn-role customer" (click)="changeRole(u, 'CUSTOMER')" [disabled]="isDeleted(u) || u.role === 'CUSTOMER'">Client</button>
          <button type="button" class="btn-role admin" (click)="changeRole(u, 'ADMIN')" [disabled]="isDeleted(u) || u.role === 'ADMIN'">Admin</button>
          <button type="button" class="btn-role super-admin" (click)="changeRole(u, 'SUPER_ADMIN')" [disabled]="isDeleted(u) || u.role === 'SUPER_ADMIN'">S.Admin</button>
        </div>

        <div class="footer">
          <button type="button" class="btn-delete" *ngIf="!isDeleted(u)" (click)="openDeleteConfirm(u)">{{ 'admin.users.action.delete' | t }}</button>
          <button type="button" class="btn-restore" *ngIf="isDeleted(u)" (click)="restoreUser(u)">{{ 'admin.users.action.restore' | t }}</button>
        </div>
      </div>
    </article>
  </section>

  <div class="pagination-bar" *ngIf="!loading && totalPages > 1">
    <button type="button" class="page-btn nav-btn" (click)="prevPage()" [disabled]="currentPage === 1">‚óÄ</button>
    <button type="button" class="page-btn" *ngFor="let p of [].constructor(totalPages); let i = index" [class.active]="currentPage === (i + 1)" (click)="goToPage(i + 1)">{{ i + 1 }}</button>
    <button type="button" class="page-btn nav-btn" (click)="nextPage()" [disabled]="currentPage === totalPages">‚ñ∂</button>
  </div>

  <div class="modal-overlay" *ngIf="deleteConfirmId !== null" (click)="cancelDelete()">
    <div class="modal" (click)="$event.stopPropagation()">
      <h3>{{ 'account.confirm.delete' | t }}</h3>
      <p>Voulez-vous d√©sactiver l'utilisateur <strong>{{ deleteConfirmName }}</strong> ?</p>
      <div class="modal-actions">
        <button type="button" class="btn-cancel" (click)="cancelDelete()">{{ 'common.cancel' | t }}</button>
        <button type="button" class="btn-confirm" (click)="confirmDelete()">{{ 'admin.users.action.delete' | t }}</button>
      </div>
    </div>
  </div>
</div>
