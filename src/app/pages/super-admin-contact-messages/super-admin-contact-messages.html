<div class="contact-admin">

  <div class="header-row">
    <div>
      <h2>Contact / Support</h2>
      <p class="hint">Messages envoyés via la page “Contact”.</p>
    </div>

    <div class="chips">
      <button
        type="button"
        class="chip"
        [class.active]="filter === 'pending'"
        (click)="setFilter('pending')">
        Non traités ({{ pendingCount }})
      </button>

      <button
        type="button"
        class="chip"
        [class.active]="filter === 'handled'"
        (click)="setFilter('handled')">
        Traités ({{ handledCount }})
      </button>

      <button
        type="button"
        class="chip"
        [class.active]="filter === 'all'"
        (click)="setFilter('all')">
        Tous ({{ totalCount }})
      </button>
    </div>
  </div>

  <p class="info" *ngIf="loading">Chargement…</p>
  <p class="error" *ngIf="error">{{ error }}</p>

  <div class="messages" *ngIf="!loading && filteredMessages.length">

    <article
      class="message-card"
      *ngFor="let m of filteredMessages"
      [class.handled]="m.handled">

      <header>
        <div>
          <strong>{{ m.name }}</strong>
          <span class="email">{{ m.email }}</span>
        </div>

        <span class="date">
          {{ m.createdAt | date:'dd/MM/yyyy HH:mm' }}
        </span>
      </header>

      <p class="message">{{ m.message }}</p>

      <footer>
        <span *ngIf="m.handled" class="handled-info">
          Traité par {{ m.handledBy }} –
          {{ m.handledAt | date:'dd/MM/yyyy HH:mm' }}
        </span>

        <button type="button" class="btn" (click)="toggleHandled(m)">
          {{ m.handled ? 'Marquer non traité' : 'Marquer traité' }}
        </button>
      </footer>

    </article>
  </div>

  <p class="info" *ngIf="!loading && !filteredMessages.length">
    Aucun message dans ce filtre.
  </p>

</div>
