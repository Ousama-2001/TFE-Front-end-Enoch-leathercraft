<div class="admin-page">
  <div class="header">
    <h1>Gestion des Avis</h1>
    <p>ModÃ©rez les avis clients (Visibles / SupprimÃ©s)</p>
  </div>

  <div class="toolbar">
    <div class="filters-group">
      <button class="filter-btn" [class.active]="filterStatus === 'ALL'" (click)="setFilter('ALL')">Tous</button>
      <button class="filter-btn visible" [class.active]="filterStatus === 'VISIBLE'" (click)="setFilter('VISIBLE')">Visibles</button>
      <button class="filter-btn deleted" [class.active]="filterStatus === 'DELETED'" (click)="setFilter('DELETED')">SupprimÃ©s</button>
    </div>

    <div class="right-tools">
      <div class="search-box">
        <input type="text" [(ngModel)]="searchTerm" placeholder="ğŸ” Rechercher (client, produit, avis)...">
      </div>

      <!-- âœ… taille de page -->
      <div class="page-size">
        <label>Par page</label>
        <select [ngModel]="pageSize" (ngModelChange)="setPageSize($event)">
          <option [ngValue]="8">8</option>
          <option [ngValue]="12">12</option>
          <option [ngValue]="16">16</option>
          <option [ngValue]="24">24</option>
        </select>
      </div>
    </div>
  </div>

  <div *ngIf="loading" class="loading">Chargement...</div>
  <div *ngIf="error" class="error">{{ error }}</div>

  <!-- âœ… pagination controls top (optionnel, tu peux enlever si tu veux) -->
  <div class="pagination-controls" *ngIf="!loading && filteredReviews.length > pageSize">
    <button class="btn small ghost" (click)="changePage(-1)" [disabled]="page === 1">â†</button>
    <span class="page-info">{{ page }} / {{ totalPages }}</span>
    <button class="btn small ghost" (click)="changePage(1)" [disabled]="page === totalPages">â†’</button>
  </div>

  <div class="reviews-grid" *ngIf="!loading">
    <div
      class="review-card"
      *ngFor="let r of paginatedReviews"
      [ngClass]="{
        'status-visible': r.status === 'VISIBLE',
        'status-deleted': r.status === 'DELETED'
      }"
    >
      <div class="card-header">
        <span class="product-name" [title]="r.productName || 'Produit Inconnu'">
          {{ r.productName || 'Produit Inconnu' }}
        </span>

        <span class="status-badge">
          <ng-container *ngIf="r.status === 'VISIBLE'">âœ… Visible</ng-container>
          <ng-container *ngIf="r.status === 'DELETED'">ğŸ—‘ SupprimÃ©</ng-container>
        </span>
      </div>

      <div class="card-body">
        <div class="meta">
          <span class="author">ğŸ‘¤ {{ r.userEmail || r.authorName || 'Anonyme' }}</span>
          <span class="date">ğŸ“… {{ r.createdAt | date:'dd/MM/yyyy' }}</span>
        </div>

        <div class="rating">
          <span *ngFor="let i of [1,2,3,4,5]" [class.filled]="i <= r.rating">â˜…</span>
        </div>

        <p class="comment">"{{ r.comment }}"</p>
      </div>

      <div class="card-actions">
        <button *ngIf="r.status === 'DELETED'" class="btn-approve" (click)="makeVisible(r.id)">
          â™»ï¸ Restaurer
        </button>

        <button *ngIf="r.status === 'VISIBLE'" class="btn-delete" (click)="deleteReview(r.id)" title="Masquer cet avis">
          ğŸš« Supprimer
        </button>
      </div>
    </div>
  </div>

  <!-- âœ… pagination controls bottom -->
  <div class="pagination-controls" *ngIf="!loading && filteredReviews.length > pageSize">
    <button class="btn small ghost" (click)="changePage(-1)" [disabled]="page === 1">â†</button>
    <span class="page-info">{{ page }} / {{ totalPages }}</span>
    <button class="btn small ghost" (click)="changePage(1)" [disabled]="page === totalPages">â†’</button>
  </div>

  <div *ngIf="!loading && filteredReviews.length === 0" class="empty">
    Aucun avis trouvÃ©.
  </div>
</div>
