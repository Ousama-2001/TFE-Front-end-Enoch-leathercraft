<!-- src/app/pages/admin-reviews/admin-reviews.html -->
<div class="admin-reviews-page">
  <header class="page-header">
    <div>
      <h1>Gestion des avis produits</h1>
      <p>Modérez les avis laissés par les clients sur les produits.</p>
    </div>
  </header>

  <!-- Filtres -->
  <section class="filters-card">
    <div class="filters-row">
      <div class="filter-group">
        <label>Statut</label>
        <select [(ngModel)]="statusFilter" (ngModelChange)="applyFilters()">
          <option value="">Tous</option>
          <option value="PENDING">En attente</option>
          <option value="APPROVED">Approuvés</option>
          <option value="REJECTED">Rejetés</option>
          <option value="DELETED">Supprimés (soft)</option>
        </select>
      </div>

      <div class="filter-group">
        <label>ID produit</label>
        <input
          type="number"
          [(ngModel)]="productIdFilter"
          (ngModelChange)="applyFilters()"
          placeholder="ex : 5"
        />
      </div>

      <div class="filter-group">
        <label>Email / nom client</label>
        <input
          type="text"
          [(ngModel)]="emailFilter"
          (keyup.enter)="applyFilters()"
          placeholder="Filtrer par email ou nom..."
        />
      </div>

      <div class="filter-actions">
        <button type="button" (click)="applyFilters()">Filtrer</button>
        <button type="button" class="secondary" (click)="resetFilters()">
          Réinitialiser
        </button>
      </div>
    </div>
  </section>

  <!-- erreurs -->
  <div class="alert error" *ngIf="error">
    {{ error }}
  </div>

  <!-- chargement -->
  <div class="loading" *ngIf="loading">
    Chargement des avis...
  </div>

  <!-- tableau des avis -->
  <section class="table-card" *ngIf="!loading && reviews.length">
    <table>
      <thead>
      <tr>
        <th>ID</th>
        <th>Produit</th>
        <th>Client</th>
        <th>Note</th>
        <th>Commentaire</th>
        <th>Statut</th>
        <th>Actions</th>
      </tr>
      </thead>

      <tbody>
      <tr *ngFor="let r of reviews">
        <td>#{{ r.id }}</td>
        <td>
          <div class="product-cell">
            <div class="product-name">{{ r.productName }}</div>
            <div class="product-id">ID: {{ r.productId }}</div>
          </div>
        </td>
        <td>
          <div class="author-cell">
            <div class="author-name">{{ r.authorName }}</div>
            <div class="author-email">{{ r.authorEmail }}</div>
          </div>
        </td>
        <td>
            <span class="rating">
              ★ {{ r.rating }}/5
            </span>
        </td>
        <td>
          <div class="comment-cell">
            {{ r.comment }}
          </div>
        </td>
        <td>
            <span [ngClass]="badgeClass(r.status)">
              {{ r.status }}
            </span>
        </td>
        <td>
          <div class="actions">
            <button
              type="button"
              (click)="changeStatus(r, 'APPROVED')"
              [disabled]="updatingId === r.id || r.status === 'APPROVED'"
            >
              Approuver
            </button>
            <button
              type="button"
              class="warning"
              (click)="changeStatus(r, 'REJECTED')"
              [disabled]="updatingId === r.id || r.status === 'REJECTED'"
            >
              Rejeter
            </button>
            <button
              type="button"
              class="danger"
              (click)="changeStatus(r, 'DELETED')"
              [disabled]="updatingId === r.id || r.status === 'DELETED'"
            >
              Supprimer
            </button>
          </div>
        </td>
      </tr>
      </tbody>
    </table>
  </section>

  <p class="empty" *ngIf="!loading && !reviews.length && !error">
    Aucun avis ne correspond à ces filtres.
  </p>
</div>
