<!-- src/app/pages/my-orders/my-orders.html -->
<div class="my-orders-page">
  <h1>Mes commandes</h1>
  <p class="subtitle">
    Retrouvez ici l’historique de vos commandes Enoch Leathercraft.
  </p>

  <!-- Messages globaux -->
  <p class="alert info" *ngIf="infoMessage">{{ infoMessage }}</p>
  <p class="alert error" *ngIf="errorMessage">{{ errorMessage }}</p>

  <!-- Chargement / erreurs -->
  <p class="info" *ngIf="loading">Chargement de vos commandes...</p>
  <p class="error" *ngIf="error">{{ error }}</p>

  <!-- État vide -->
  <div *ngIf="!loading && !error && orders.length === 0" class="empty">
    Vous n’avez encore passé aucune commande.
  </div>

  <!-- LISTE DES COMMANDES -->
  <div class="orders-list" *ngIf="!loading && !error && orders.length > 0">
    <article class="order-card" *ngFor="let o of orders">
      <div class="order-main">
        <div>
          <h2>Commande {{ o.reference }}</h2>
          <p class="date">
            Passée le {{ o.createdAt | date:'dd/MM/yyyy à HH:mm' }}
          </p>
        </div>

        <div class="order-meta">
          <span [class]="getStatusClass(o.status)">
            {{ getStatusLabel(o.status) }}
          </span>
          <div class="amount">
            {{ o.totalAmount | currency:'EUR' }}
          </div>
        </div>
      </div>

      <!-- petit résumé -->
      <div class="order-summary">
        {{ o.items.length }} article(s)
      </div>

      <!-- ACTIONS -->
      <div class="order-actions">
        <!-- ✅ lien vers /my-orders/:id -->
        <a
          [routerLink]="['/my-orders', o.id]"
          class="btn ghost"
        >
          Voir le détail →
        </a>

        <!-- Annuler -->
        <button
          type="button"
          class="btn secondary"
          *ngIf="canCancel(o)"
          (click)="cancelOrder(o)"
          [disabled]="actionLoading[o.id]"
        >
          Annuler
        </button>

        <!-- Payer -->
        <button
          type="button"
          class="btn primary"
          *ngIf="canPay(o)"
          (click)="payOrder(o)"
          [disabled]="actionLoading[o.id]"
        >
          {{ actionLoading[o.id] ? 'Traitement...' : 'Payer maintenant' }}
        </button>

        <!-- Facture -->
        <button
          type="button"
          class="btn ghost"
          *ngIf="canDownloadInvoice(o)"
          (click)="downloadInvoice(o)"
          [disabled]="actionLoading[o.id]"
        >
          Télécharger la facture
        </button>
      </div>
    </article>
  </div>
</div>
